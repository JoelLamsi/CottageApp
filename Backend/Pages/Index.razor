@page "/"
@using System.Net.Http.Json
@using Microsoft.EntityFrameworkCore
@using Backend.Data
@using DataObjects
@inject IDbContextFactory<ApplicationDbContext> ApplicationDataContextFactory

@foreach (var cottage in Cottages)
{
    <CottageListItem Cottage="@cottage"/>
}

@code {
    public Cottage cottage { get; set; }
    public List<Cottage>? Cottages { get; set; }
    private ApplicationDbContext? _context;

    @* protected override void OnInitialized()
    {
        Cottages = new List<Cottage>()
        {
            new Cottage()
            {
                Title = "Foo",
                Description = $"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                PictureUrl = "img/cottage1.jpeg",
                DateAdded = DateTime.Now,
                Ratings = new int[] {1,2, 4, 1, 3}
            },
            new Cottage()
            {
                Title = "Bar",
                PictureUrl = "img/cottage2.jpeg",
                DateAdded = new DateTime(2020, 12, 31),
                Ratings = new int[] {5}
            }
        };
    } *@

    protected override async Task OnInitializedAsync()
    {
        _context ??= await ApplicationDataContextFactory.CreateDbContextAsync();

        if (_context is not null)
        {
            Cottages = await _context.Cottages.ToListAsync();
            await _context.DisposeAsync();
        } 
    }
}